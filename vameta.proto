syntax = "proto3";

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

package VAMetaService;
/*
    va metadata streaming service
*/
service VAMetaService {
    rpc GetVAMetaStream (google.protobuf.Empty) returns (FrameMetaData); 
}
/*
    detected meta in frame
*/
message FrameMetaData {
    string channel_id = 1;                   // 채널 ID
    google.protobuf.Timestamp timestamp = 2; // 발생 시간
    repeated EventInfo event_list = 3;       // 이벤트 검출 리스트
    repeated Segmetation object_list = 4;    // 객체 검출 
}
/*
    detected segmentation info
*/
message Segmetation {
    ObjectType label = 1;         // 객체 종류 (enum ObjectType 참고)
    BoundingBox box = 2;          // 객체 검출 박스 좌표
    int32 confidence = 3;         // 검출 정확도 (0 ~1)
}
/*
    alram event info
*/
message EventInfo {
    int32 id = 1;                   // 객체 ID
    int32 roi_id = 2;               // 발생 영역 ID
    State state = 3;                // 진행 상태
    Segmetation segmentation = 4;   // 검출 정보
    EventType event_type = 5;       // 이벤트 타입 (enum EventType 참고)
    string base64_jpg_image = 6;    // 검출 객체 이미지 (jpeg image --> base64 encoding)
    oneof detail {
        Face face = 7;
        ITS its = 8;
    }
}
message Face {
    string name = 1;   //이름
    int32 age = 2;     //나이
    Gender gender = 3; //성별 (enum Gender 참고)
    string memo = 4;
}
message ITS {
    
}
/*
    검출 객체 정보
*/
message BoundingBox {
    double x = 1;      //객체 박스 x좌표 (영상 비율, Normalization : 0 ~ 1)
    double y = 2;      //객체 박스 y좌표 (영상 비율, Normalization : 0 ~ 1)
    double width = 3;  //객체 박스 너비  (영상 비율, Normalization : 0 ~ 1)
    double height = 4; //객체 박스 높이  (영상 비율, Normalization : 0 ~ 1)
}

/*
    이벤트 종류
*/
enum EventType
{   
    LONGSTAY = 0;               //체류
    LOITERING = 1;              //배회
    INTRUSION = 2;              //침입
    FALLDOWN = 3;               //쓰러짐
    ABANDONED = 4;              //유기
    CONGESTION = 10;            //혼잡도
    LINECROSSING = 11;          //라인, 방향성 파라메터 필요
    DOUBLELINECROSSING = 16;    //단방향 연속 라인 통과
    SPEED = 18;                 //속도측정, 라인 두개 그림
    STOP = 20;                  //정지
}

/*
    객체 종류
*/
enum ObjectType
{
    PERSON = 0;                   // 사람
    BIKE = 1;                     // 자전거
    CAR = 2;                      // 승용차
    MOTORCYCLE = 3;               // 오토바이
    BUS = 4;                      // 버스
    TRUCK = 5;                    // 트럭
    EXCAVATOR =6;                 // 굴착기
    TANKTRUCK = 7;                // 탱크트럭
    FORKLIFT = 8;                 // 지게차
    LEMICON = 9;                  // 레미콘
    CULTIVATOR = 10;              // 경운기
    TRACTOR = 11;                 // 트랙터
}
/*
    이벤트 발생 상태값
*/
enum State
{
    START = 0;      //시작
    CONTINUE = 1;   //진행
    END =2;         //종료
}
/*
    성별
*/
 enum Gender
 {
    MAN = 0; //남자
    WOMAN = 1; //여자
 }
